<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="../../favicon.ico">

  <title>Dokapon Heroes</title>

  <!-- Bootstrap core CSS -->
  <link href="../../assets/css/bootstrap.min.css" rel="stylesheet">

</head>

<body onload="checkAccount()">
  <div class="container">

    <form class="form-signin col-md-6" onsubmit="login()">
      <h2 class="form-signin-heading">Who dis?</h2>
      <div 
      <input id="btnAccount" type="button" class="btn btn-lg btn-primary col-md-3" onclick="newAccount()" value="Im new">
      <!--Email field-->
      <label for="inputEmail" class="sr-only">Email address</label>
      <input type="text" id="inputEmail" class="form-control" placeholder="Email address" autofocus><br>
      <!--Display name field-->
      <label for="password" class="sr-only">Display Name</label>
      <input type="password" id="password" class="form-control" placeholder="Password" required><br>
      <!--login button-->
      <input id="btnLogin" type="button" class="btn btn-lg btn-primary col-md-3" onclick="login()" value="LETS GO">
    </form>
    <p id="z"></p>
  </div>
  <!-- /container -->
  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io();
    //receiving an id back. This is triggered if the user exist on login or when a new user is created
    socket.on('userJSON', function (msg) {
      //Sets id in local storage
      document.getElementById("z").innerHTML = "test";
      localStorage.setItem('user', JSON.stringify(msg));
      localStorage.setItem('id', msg._id);
      localStorage.setItem('dname', msg.dname);
      localStorage.setItem('email', msg.email);
      //moves user to the landing page
      window.location.href = 'landing.html';
    });
  </script>
  <script>
    //executed on clicking the login button
    function login() {
      event.preventDefault();
      document.getElementById("btnLogin").disabled = true;
      if (document.getElementById("inputEmail").length == 0) {
        document.getElementById("inputEmail").classList.add('has-error');
        if (document.getElementById("password").length == 0) {
          document.getElementById("password").classList.add('has-error');
        }
        return false;
      }
      if (document.getElementById("password").length == 0) {
        document.getElementById("password").classList.add('has-error');
        return false;
      }
      //grabs the email and display name field vales and puts them in an object
      var JSONuser = {
        "email": document.getElementById("inputEmail").value,
        "password": document.getElementById("password").value
      }
      //sends the object to the server
      socket.emit('user', JSONuser);
      document.getElementById("btnLogin").disabled = false;
    };
    //Executed on loading page, checks if the user has an id in local storage  
    function checkAccount() {
      if (typeof (Storage) !== 'undefined') {
        if (localStorage.user) {
          window.location.href = 'landing.html';
        }
      }
    }
    function newAccount(){
      window.location.href = 'createAccount.html';
    }
  </script>
</body>

</html>