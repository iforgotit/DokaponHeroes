<html>

<head>
    <Title>Making a game</title>
    <script src="https://code.createjs.com/easeljs-0.8.0.min.js"></script>
    <script src="https://code.createjs.com/tweenjs-0.6.0.min.js"></script>
    <script src="https://code.createjs.com/preloadjs-0.6.0.min.js"></script>
</head>

<body onload="init();" style=" background: lightblue;">
    <script src="https://code.createjs.com/easeljs-0.8.0.min.js"></script>
    <canvas id="demoCanvas" width="320px" height="320px" style="background: #fff; margin:10px"></canvas>
    <p id="x"></p>
    <p id="y"></p>
    <p id="z"></p>
    <script>
        function init() {
            
            var queue = new createjs.LoadQueue();
            queue.loadFile("sprites.png");
            queue.on("progress", function() {
                console.log("Progress:", queue.progress, event.progress);
            });

            var stage = new createjs.Stage("demoCanvas");

            createjs.Touch.enable(stage);

            stage.enableMouseOver();

            var graphics = new createjs.Graphics().beginFill("#ffffff").drawRect(0, 0, 300, 300);
            var canvas = new createjs.Shape(graphics);
            var data = {
                images: ["sprites.png"],
                frames: {
                    width: 76,
                    height: 64,
                    spacing: 20,
                    regX: 50,
                    regY: 50
                },
                animations: {
                    stand: 2,
                    run: [21, 28, "run", 0.5],
                    turnRight: [21, 28, "run", 0.5]
                }
            };

			stage.addChild(canvas);

            var padding = 1;
            var width = 99;
            var height = 99;
            var cols = 3;
            for(var i=0;i<200;i++) {
                var s = new createjs.Shape();
                s.overColor = "#3281FF"
                s.outColor = "#FF0000"
                s.graphics.beginFill(s.outColor).drawRect(0, 0, width, height).endFill();
                s.x = (width + padding) * (i%cols);
                s.y = (height + padding) * (i/cols|0);
                s.onMouseOver = handleMouseOver;
                s.onMouseOut = handleMouseOut;
                stage.addChild(s)
            }

            var spriteSheet = new createjs.SpriteSheet(data);
            var hero = new createjs.Sprite(spriteSheet, "stand");
            hero.x = 100;
            hero.y = 100;
            
            stage.addChild(hero);
            
            createjs.Ticker.setFPS(30);
            createjs.Ticker.addEventListener("tick", stage);
            canvas.addEventListener("click", recordMouse);


            function recordMouse(event) {
                document.getElementById("x").innerHTML = event.stageX;
                document.getElementById("y").innerHTML = event.stageY;
                if (hero.x > event.stageX) {
                    hero.scaleX = -1;
                    hero.gotoAndPlay("run");
                } else {
                    hero.gotoAndPlay("run");
                    hero.scaleX = 1;
                }

                createjs.Tween.get(hero, {
                        loop: false
                    })
                    .to({
                        x: event.stageX,
                        y: event.stageY
                    }, 1000)
                    .call(setStandanimation);
            }

            function setStandanimation() {
                hero.gotoAndPlay("stand");
            }

            function setTurnanimation() {
                hero.gotoAndPlay("turnRight");
            }

            function handleMouseOver(event) {
            var target = event.target;
            target.graphics.clear().beginFill(target.overColor).drawRect(0, 0, width, height).endFill();
            }

            function handleMouseOut(event) {
                var target = event.target;
                target.graphics.clear().beginFill(target.outColor).drawRect(0, 0, width, height).endFill();
            }
            function tick() {
  stage.update();   
}
        
        }
    </script>
</body>

</html>